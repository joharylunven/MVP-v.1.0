<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Brand Story Review ‚Äî Project One √ó Wheel the World</title>
  <meta name="description" content="A premium interactive brand story review experience by Project One ‚Äî Brand Synthesis Lab." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0f1215;
      --card: #12161b;
      --muted: #9aa3ad;
      --text: #e7edf5;
      --accent: #186B68; /* Deep Teal from DNA */
      --accent-2: #EFE6D3; /* Cream */
      --border: #1f2a33;
      --ok: #2dce89;
      --warn: #f6c343;
      --danger: #e44c65;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      scroll-behavior: smooth;
    }
    [data-theme="light"] {
      --bg: #f7f8fb;
      --card: #ffffff;
      --muted: #667085;
      --text: #101828;
      --accent: #186B68;
      --accent-2: #efe6d3;
      --border: #e6e9ef;
      --shadow: 0 10px 30px rgba(10,18,28,.08);
    }
    * {box-sizing: border-box}
    html, body {height: 100%}
    body {
      margin: 0;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Noto Sans, Ubuntu, Cantarell, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1200px 800px at 20% -10%, rgba(24,107,104,.35), transparent 60%), var(--bg);
      color: var(--text);
      line-height: 1.6;
    }
    .grid {
      display: grid; grid-template-columns: 300px 1fr; gap: 28px; max-width: 1250px; margin: 0 auto; padding: 22px;
    }
    header.hero {
      position: sticky; top: 0; z-index: 10; backdrop-filter: saturate(1.2) blur(10px);
      border-bottom: 1px solid var(--border);
    }
    .hero-inner {max-width:1250px; margin:0 auto; padding: 18px 22px; display:flex; align-items:center; gap:18px}
    .logo {
      width: 42px; height: 42px; display:grid; place-items:center; border-radius: 12px;
      background: conic-gradient(from 200deg at 50% 50%, var(--accent), #1b8f8a, #0b3f3d, var(--accent));
      color: white; font-weight: 800; letter-spacing: .5px; box-shadow: var(--shadow);
    }
    .titleblock {flex:1}
    h1 {font-size: 20px; margin: 0 0 4px}
    .subtitle {font-size: 13px; color: var(--muted)}
    .actions {display:flex; gap:8px; flex-wrap: wrap}
    button, .btn {
      appearance:none; border: 1px solid var(--border); background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(0,0,0,.02)); color: var(--text);
      padding: 10px 12px; border-radius: 12px; font-weight: 600; font-size: 13px; cursor: pointer; transition: .2s ease; box-shadow: var(--shadow);
    }
    button:hover, .btn:hover {transform: translateY(-1px); border-color: #2c3d49}
    .btn-primary {background: linear-gradient(180deg, #1b8f8a, var(--accent)); border-color: transparent}
    .btn-primary:hover {filter: brightness(1.05)}
    nav.sidenav {position: sticky; top: 84px; align-self:start; padding-bottom: 40px}
    .navcard {background: var(--card); border:1px solid var(--border); border-radius: 16px; padding: 16px}
    .navcard h3 {margin: 0 0 10px; font-size: 13px; text-transform: uppercase; letter-spacing: .12em; color: var(--muted)}
    .navcard a {display:flex; align-items:center; gap: 8px; padding: 8px 10px; border-radius:10px; color: var(--text); text-decoration:none; font-size: 14px}
    .navcard a:hover {background: rgba(24,107,104,.12)}
    .navcard a .status-icon {
      width: 16px; height: 16px; font-size: 10px; display: inline-flex;
      align-items: center; justify-content: center; border-radius: 50%;
      border: 1px solid var(--border); color: var(--muted);
    }
    .navcard a .status-icon.approved {
      background: rgba(45, 206, 137, .15); border-color: var(--ok); color: var(--ok);
    }
    .navcard a .status-icon.changes {
      background: rgba(246, 195, 67, .15); border-color: var(--warn); color: var(--warn);
    }
    .progress {
      display:flex; align-items:center; gap:10px; margin-bottom: 10px; font-size: 13px; color: var(--muted)
    }
    .bar {height: 8px; background: #192127; border-radius: 999px; overflow: hidden; border:1px solid var(--border)}
    .bar > span {display:block; height:100%; width:0; background: linear-gradient(90deg, #1b8f8a, var(--accent)); transition: width .4s ease}
    main {display:grid; gap: 18px}
    section.card {background: var(--card); border:1px solid var(--border); border-radius: 18px; padding: 24px; box-shadow: var(--shadow)}
    section.card header {display:flex; align-items:center; gap:12px; margin-bottom: 12px}
    section.card header h2 {margin:0; font-size: 20px}
    blockquote {
        margin: 16px 0; padding: 12px 18px; border-left: 3px solid var(--accent);
        background: rgba(24,107,104,.08); border-radius: 0 8px 8px 0;
    }
    .kvs {display:grid; gap:6px; grid-template-columns: repeat(12, 1fr)}
    .kv {grid-column: span 6}
    .kv small {display:block; color: var(--muted); font-size: 12px}
    .kv strong {display:block; font-size: 15px}
    .stack {display:grid; gap: 16px}
    .pill {display:inline-flex; align-items:center; gap:8px; border:1px solid var(--border); background: rgba(255,255,255,.02); padding:6px 12px; border-radius:999px; font-size: 13px; cursor: pointer;}
    .approvebox {display:grid; gap:8px; grid-template-columns: 1fr 220px; margin-top: 24px;}
    .controls {display:flex; gap: 8px; flex-wrap: wrap; align-items:center; justify-content:flex-end}
    .radio {display:inline-flex; align-items:center; gap:6px; font-size: 13px; padding: 6px 10px; border-radius: 999px; border:1px solid var(--border)}
    textarea.note {width: 100%; min-height: 72px; resize: vertical; border-radius: 12px; border:1px solid var(--border); padding:10px; background: rgba(255,255,255,.02); color: var(--text)}
    ul.clean, ol.clean {margin: 8px 0 0 18px; padding-left: 0; list-style-position: inside;}
    .muted {color: var(--muted)}
    footer {max-width:1250px; margin: 24px auto 100px; padding: 0 22px; color: var(--muted)}
    .actions .label { display: none; }
    .actions .icon { margin-right: 0; }
    .banner {
      background: var(--card); border-bottom: 1px solid var(--border); padding: 0 22px;
      display: flex; align-items: center; gap: 16px; max-width: 1250px; margin: 0 auto;
    }
    .banner p { flex: 1; margin: 12px 0; font-size: 14px; color: var(--muted); }
    .banner button {
      background: transparent; border: none; font-size: 24px;
      padding: 0 12px; opacity: .7; box-shadow: none;
    }
    .toast {
      position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
      background: var(--ok); color: white; padding: 10px 20px;
      border-radius: 999px; font-size: 14px; font-weight: 600; z-index: 999;
      opacity: 0; transition: opacity .3s ease, transform .3s ease;
      pointer-events: none;
    }
    .toast.show { opacity: 1; transform: translateX(-50%) translateY(-10px); }

    /* Print styles */
    @media print {
      header.hero, nav.sidenav, .actions, .controls, .btn, .no-print, .banner {display:none !important}
      body {background: white; color: black;}
      section.card {page-break-inside: avoid; box-shadow: none; border: 1px solid #ccc;}
      :root {
        --bg: #ffffff; --card: #ffffff; --muted: #555555; --text: #000000;
        --border: #dddddd;
      }
    }

    /* Responsive styles */
    @media (max-width: 900px) {
      .grid { grid-template-columns: 1fr; }
      nav.sidenav { position: static; margin-bottom: 24px; }
      .approvebox { grid-template-columns: 1fr; }
      .controls { justify-content: flex-start; }
      .actions .label { display: inline; }
      .actions .icon { margin-right: 6px; }
      .actions { justify-content: center; }
    }
    @media (max-width: 600px) {
        .hero-inner { flex-direction: column; gap: 16px; }
        .kvs { grid-template-columns: 1fr; }
        .kv { grid-column: span 1; }
    }
  </style>
</head>
<body>
  <header class="hero">
    <div class="hero-inner">
      <div class="logo" aria-label="Project One">P1</div>
      <div class="titleblock">
        <h1>Brand Story Review ‚Äî Wheel the World</h1>
        <div class="subtitle">Project One ¬∑ Brand Synthesis Laboratory ¬∑ Live Preview</div>
      </div>
      <div class="actions">
        <button class="btn" id="toggleTheme" title="Toggle theme"><span class="icon">üåì</span><span class="label">Theme</span></button>
        <button class="btn" id="exportFeedback" title="Export feedback JSON"><span class="icon">üßæ</span><span class="label">Feedback</span></button>
        <button class="btn" id="copySummary" title="Copy review summary"><span class="icon">üìã</span><span class="label">Summary</span></button>
        <button class="btn btn-primary" id="printPdf" title="Print / Save as PDF"><span class="icon">üñ®Ô∏è</span><span class="label">Review PDF</span></button>
      </div>
    </div>
  </header>

  <div class="banner" id="welcomeBanner">
    <p><strong>Welcome to your Brand Story Review!</strong> Please review each chapter, then use the controls at the bottom to approve or request changes. Your progress is saved automatically.</p>
    <button class="btn no-print" id="dismissBanner">&times;</button>
  </div>

  <div class="grid">
    <aside>
      <div class="navcard">
        <div class="progress">
          <div class="bar" style="flex:1"><span id="progressBar"></span></div>
          <span id="progressText">0% approved</span>
        </div>
        <h3>Chapters</h3>
        <nav class="sidenav" id="sidenav"></nav>
      </div>
    </aside>

    <main id="content"></main>
  </div>

  <footer>
    <p class="muted">This interface is a portable one-file review kit. Approvals and notes are saved locally in your browser. Use <strong>Feedback</strong> to export decisions as JSON, or <strong>Review PDF</strong> to print/save.</p>
  </footer>

  <div class="toast" id="saveToast">‚úÖ Changes saved</div>

  <script id="brandData" type="application/json">{
  "client": {
    "name": "Wheel the World"
  },
  "story": [
    {
      "id": "north-star",
      "title": "Our North Star: The Problem We Solve",
      "content": [
        { "type": "paragraph", "text": "The world of travel is filled with vague promises. Labels like 'accessible' or 'friendly' mean little without proof, forcing travelers with disabilities to become detectives just to plan a trip. They spend countless hours on the phone, trying to confirm if a hotel room *actually* meets their specific needs. This uncertainty creates stress and turns the joy of trip planning into a high-stakes gamble." },
        { "type": "paragraph", "text": "Wheel the World exists to replace that uncertainty with verified confidence. We are here to make the world accessible by turning vague claims into bookable facts." },
        { "type": "blockquote", "text": "Our purpose is to empower people to explore without limits. We do this by providing granular, verified details, guaranteed accessibility, and human support every step of the way." }
      ]
    },
    {
      "id": "values",
      "title": "What We Believe (Our Values)",
      "content": [
        { "type": "paragraph", "text": "Our values are the commitments that guide every decision we make, from how we design our platform to how we speak with our customers." },
        { "type": "list", "items": [
          "<strong>Dignity:</strong> We center the traveler‚Äôs autonomy and comfort in everything we do. Our users are explorers, not patients.",
          "<strong>Verification:</strong> We believe in facts over labels. We show measurements and photos, not just slogans.",
          "<strong>Empathy:</strong> We address real-world constraints with plain, respectful language. No euphemisms, no pity.",
          "<strong>Reliability:</strong> We make commitments that hold up from the curb to the room, and from the door to the shower.",
          "<strong>Adventure:</strong> We exist to enable joyful exploration, not just functional access."
        ]}
      ]
    },
    {
      "id": "voice",
      "title": "Our Voice: Speaking with Dignity and Clarity",
      "content": [
        { "type": "paragraph", "text": "Our voice is that of an empathetic expert and a trusted guide. We understand the critical details our users need, and we deliver that information with warmth and directness. We are reassuring, clear, and always respectful." },
        { "type": "key_points", "points": [
          { "label": "Our Character", "value": "Empathetic, expert, direct, and reassuring." },
          { "label": "What We Do", "value": "Lead with verified facts. Use person-first, dignity-first language. Write short, active sentences that get to the point." },
          { "label": "What We Avoid", "value": "Vague buzzwords ('handicap-friendly'), medicalized tones, or framing disability as an obstacle to be 'overcome'." }
        ]},
        { "type": "blockquote", "text": "A signature phrase that captures our voice: 'Verified accessibility, from planning to check-in.'" }
      ]
    },
    {
      "id": "visuals",
      "title": "Our Look & Feel: Designing for Confidence",
      "content": [
        { "type": "paragraph", "text": "Our visual identity is designed to build trust and provide clarity. It's clean, warm, and highly functional‚Äîlike a well-designed map that inspires confidence for the journey ahead." },
        { "type": "list", "items": [
          "<strong>Color Palette:</strong> Our colors are calm and trustworthy. A deep teal provides a sense of stability and calm, while warm cream and crisp charcoal create a comfortable, high-contrast, and easy-to-read environment.",
          "<strong>Typography:</strong> We use clean, geometric, and highly legible fonts. Our priority is always clarity and ease of reading, ensuring critical information is never missed.",
          "<strong>Imagery & Photography:</strong> We show real travelers in real environments. Our photos are both beautiful and useful, celebrating the joy of discovery while clearly framing the functional features that make it possible. We always pair the beauty shot with the proof shot."
        ]}
      ]
    },
    {
      "id": "action",
      "title": "Our Promise in Action: From Content to Check-in",
      "content": [
        { "type": "paragraph", "text": "Our brand isn't just a collection of ideas; it's a tangible promise we deliver through our product and content. This is how our philosophy comes to life for our users." },
        { "type": "list", "items": [
          "<strong>The Accessibility Profile:</strong> We empower users to tell us their specific needs once, so we can do the heavy lifting of finding perfect, verified matches for them.",
          "<strong>The Verification Standard:</strong> We meticulously map hotels and activities with a standardized checklist, capturing the real measurements and photos that matter.",
          "<strong>The Guarantee:</strong> Our 'Accessible Room Guarantee' is our ultimate commitment. It ensures that what our users book is what they get upon arrival.",
          "<strong>Our Content:</strong> We educate and inspire by showcasing verified destinations and sharing real traveler stories. We always lead with the facts that build trust and enable adventure."
        ]}
      ]
    },
    {
      "id": "success",
      "title": "How We Know We're Succeeding",
      "content": [
        { "type": "paragraph", "text": "Success for us isn't just measured in bookings. It's measured by the trust we build and the confidence we create. We know we're succeeding when..." },
        { "type": "list", "items": [
          "...more travelers book with the confidence that comes from using their detailed Accessibility Profile.",
          "...the density of verified, measured, and photographed listings on our platform grows every single day.",
          "...our guarantee claims are exceptionally rare, proving the reliability and accuracy of our verification process."
        ]}
      ]
    },
    {
      "id": "validation",
      "title": "Confirming Our Shared Vision",
      "content": [
        { "type": "paragraph", "text": "Please review the core principles of our brand story. Your confirmation on these points will align our teams and set the foundation for all creative and product work moving forward." },
        { "type": "checklist", "items": [
          "Our brand promise, 'Explore without limits,' captures our core purpose.",
          "Our values (Dignity, Verification, Empathy, Reliability, Adventure) are the right guiding principles.",
          "The 'empathetic expert' voice feels authentic to our brand.",
          "Our 'design for confidence' visual approach aligns with our goals.",
          "The promise of a guarantee is central to building user trust."
        ]}
      ]
    }
  ]
}</script>

  <script>
  const data = JSON.parse(document.getElementById('brandData').textContent);

  // --- Utilities ---
  const $ = (sel, el=document) => el.querySelector(sel);
  const $$ = (sel, el=document) => Array.from(el.querySelectorAll(sel));
  const stateKey = 'p1_brand_review_state_v4_story';
  let reviewState = JSON.parse(localStorage.getItem(stateKey) || '{}');

  let toastTimeout;
  function showToast() {
    const toast = $('#saveToast');
    if (!toast) return;
    toast.classList.add('show');
    clearTimeout(toastTimeout);
    toastTimeout = setTimeout(() => {
      toast.classList.remove('show');
    }, 1500);
  }

  function saveState(){
    localStorage.setItem(stateKey, JSON.stringify(reviewState));
    recalcProgress();
    showToast();
  }

  function progressInfo(){
    const entries = Object.entries(reviewState.sections || {});
    const total = sections.length || 1;
    const approved = entries.filter(([,v]) => v.status === 'approved').length;
    return { total, approved, pct: Math.round(approved/total*100) };
  }

  function recalcProgress(){
    const {pct, approved, total} = progressInfo();
    $('#progressBar').style.width = pct + '%';
    $('#progressText').textContent = approved + '/' + total + ' approved (' + pct + '%)';

    sections.forEach(({id, title}) => {
      const link = $(`a[data-nav-id="${id}"]`);
      if (!link) return;
      const status = (reviewState.sections && reviewState.sections[id]?.status) || 'pending';
      let icon = '‚Ä¢';
      let iconClass = '';
      if (status === 'approved') {
        icon = '‚úì';
        iconClass = 'approved';
      } else if (status === 'changes') {
        icon = '‚úçÔ∏è';
        iconClass = 'changes';
      }
      link.innerHTML = `<span class="status-icon ${iconClass}">${icon}</span> ${title}`;
    });
  }

  function dl(filename, text){
    const blob = new Blob([text], {type: 'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = filename; a.click(); URL.revokeObjectURL(url);
  }

  function toSlug(str){ return String(str).toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,''); }

  function setTheme(mode){ document.documentElement.setAttribute('data-theme', mode); localStorage.setItem('p1_theme', mode); }

  // --- Renderers ---
  const content = $('#content');
  const sidenav = $('#sidenav');
  const sections = [];

  function buildContent(contentData) {
    const fragment = document.createDocumentFragment();
    const stack = document.createElement('div');
    stack.className = 'stack';
    contentData.forEach(item => {
      if (item.type === 'paragraph') {
        const p = document.createElement('p'); p.innerHTML = item.text; stack.appendChild(p);
      } else if (item.type === 'blockquote') {
        const bq = document.createElement('blockquote'); bq.innerHTML = item.text; stack.appendChild(bq);
      } else if (item.type === 'list') {
        const ul = document.createElement('ul'); ul.className = 'clean';
        item.items.forEach(liText => { const li = document.createElement('li'); li.innerHTML = liText; ul.appendChild(li); });
        stack.appendChild(ul);
      } else if (item.type === 'key_points') {
        const kvs = document.createElement('div'); kvs.className = 'kvs';
        item.points.forEach(point => { const kv = document.createElement('div'); kv.className = 'kv'; kv.innerHTML = `<small>${point.label}</small><strong>${point.value}</strong>`; kvs.appendChild(kv); });
        stack.appendChild(kvs);
      } else if (item.type === 'checklist') {
        const ul = document.createElement('ul'); ul.className = 'clean'; ul.style.listStyle = 'none';
        item.items.forEach((txt, i) => { const id = 'vc-' + i; const li = document.createElement('li'); li.innerHTML = `<label class="pill"><input type="checkbox" id="${id}"> ${txt}</label>`; ul.appendChild(li); });
        stack.appendChild(ul);
      }
    });
    fragment.appendChild(stack);
    return fragment;
  }

  function addSection(id, title, bodyEl, isLast = false) {
    const sec = document.createElement('section'); sec.className = 'card'; sec.id = id;
    const header = document.createElement('header'); const h2 = document.createElement('h2'); h2.textContent = title; header.appendChild(h2); sec.appendChild(header); sec.appendChild(bodyEl);
    
    if (!isLast) {
      const controlsWrap = document.createElement('div'); controlsWrap.className = 'approvebox';
      const controls = document.createElement('div'); controls.className = 'controls';
      controls.innerHTML = `<label class="radio"><input type="radio" name="${id}-status" value="approved"> ‚úÖ Approve</label> <label class="radio"><input type="radio" name="${id}-status" value="changes"> ‚úçÔ∏è Needs changes</label>`;
      const note = document.createElement('textarea'); note.className = 'note'; note.placeholder = 'Optional note for this section...';
      controlsWrap.appendChild(note); controlsWrap.appendChild(controls); sec.appendChild(controlsWrap);
      
      reviewState.sections = reviewState.sections || {};
      reviewState.sections[id] = reviewState.sections[id] || { status: '', note: '' };
      const current = reviewState.sections[id];
      if (current.status) { $$(`input[name="${id}-status"]`, controls).find(r => r.value === current.status)?.setAttribute('checked', 'checked'); }
      note.value = current.note || '';
      const updateState = () => {
        reviewState.sections[id].status = $('input[name="' + id + '-status"]:checked', controls)?.value || '';
        reviewState.sections[id].note = note.value;
        saveState();
      };
      controls.addEventListener('change', updateState);
      note.addEventListener('input', updateState);
    } else {
        const form = document.createElement('div'); form.className = 'grid'; form.style.gridTemplateColumns = '1fr 1fr 1fr'; form.style.gap = '12px'; form.style.marginTop = '20px';
        function input(label, key, placeholder = '', id) {
            const d = document.createElement('div');
            const l = document.createElement('div'); l.className = 'muted'; l.textContent = label; d.appendChild(l);
            const i = document.createElement('input'); i.type = 'text'; i.placeholder = placeholder; i.id = id;
            i.style.cssText = 'width: 100%; padding: 10px; border-radius: 10px; border: 1px solid var(--border); background: rgba(255,255,255,.02); color: var(--text);';
            i.value = (reviewState.approvals || {})[key] || '';
            i.addEventListener('input', () => { reviewState.approvals = reviewState.approvals || {}; reviewState.approvals[key] = i.value; saveState(); });
            d.appendChild(i); return d;
        }
        form.appendChild(input('Reviewer name', 'name', 'Full name', 'reviewerNameInput'));
        form.appendChild(input('Title/role', 'title', 'e.g., CMO', 'reviewerTitleInput'));
        form.appendChild(input('Approval date (UTC)', 'date', new Date().toISOString().slice(0, 10), 'reviewerDateInput'));

        const buttonCell = document.createElement('div');
        buttonCell.style.cssText = 'grid-column: 1 / -1; text-align: right; margin-top: 16px;';
        const finalExportButton = document.createElement('button');
        finalExportButton.className = 'btn btn-primary'; finalExportButton.id = 'finalExportBtn';
        finalExportButton.style.display = 'none';
        finalExportButton.innerHTML = '‚úÖ Complete &amp; Export Feedback';
        finalExportButton.addEventListener('click', () => {
            // New: Set the final section to 'approved'
            reviewState.sections['validation'].status = 'approved';
            saveState(); // This saves the state and updates the UI (menu checkmark)
            
            // Original: Trigger the download
            $('#exportFeedback').click();
        });
        buttonCell.appendChild(finalExportButton);
        form.appendChild(buttonCell);

        sec.appendChild(form);
    }

    content.appendChild(sec);
    const a = document.createElement('a'); a.href = '#' + id; a.dataset.navId = id; sidenav.appendChild(a); sections.push({ id, title });
  }

  // --- Render all sections from data ---
  data.story.forEach((sectionData, index) => {
    const body = buildContent(sectionData.content);
    const isLastSection = index === data.story.length - 1;
    addSection(sectionData.id, sectionData.title, body, isLastSection);

    if (sectionData.id === 'validation') {
        const checkBoxes = $$('input[type="checkbox"]', body);
        const nameInput = $('#reviewerNameInput');
        const titleInput = $('#reviewerTitleInput');
        const dateInput = $('#reviewerDateInput');
        const finalExportBtn = $('#finalExportBtn');
        const inputs = [nameInput, titleInput, dateInput, ...checkBoxes];

        reviewState.validation = reviewState.validation || {};
        reviewState.sections['validation'] = reviewState.sections['validation'] || {status: '', note: ''};
        
        const checkFinalCompletion = () => {
            const allBoxesChecked = checkBoxes.every(cb => cb.checked);
            const allFieldsFilled = nameInput.value.trim() !== '' && titleInput.value.trim() !== '' && dateInput.value.trim() !== '';
            
            if (allBoxesChecked && allFieldsFilled) {
                finalExportBtn.style.display = 'inline-flex';
            } else {
                finalExportBtn.style.display = 'none';
            }
        };

        checkBoxes.forEach(cb => {
            cb.checked = !!reviewState.validation[cb.id];
            cb.addEventListener('change', () => {
                reviewState.validation[cb.id] = cb.checked;
                checkFinalCompletion();
            });
        });
        
        [nameInput, titleInput, dateInput].forEach(input => {
            input.addEventListener('input', checkFinalCompletion);
        });
        
        checkFinalCompletion(); // Initial check on load
    }
  });

  // --- Theme & Button Wiring ---
  (function(){ try { document.documentElement.style.setProperty('--accent', '#186B68'); } catch(e){} })();
  setTheme(localStorage.getItem('p1_theme')||'dark');
  $('#toggleTheme').addEventListener('click', ()=>{ const current = document.documentElement.getAttribute('data-theme')||'dark'; setTheme(current==='dark'?'light':'dark'); });
  $('#exportFeedback').addEventListener('click', ()=>{ const payload = { meta: { exported_at: new Date().toISOString(), source: 'Project One review site v4' }, client: data.client, review: reviewState }; dl(`${toSlug(data.client.name)}_brand_story_feedback.json`, JSON.stringify(payload, null, 2)); });
  $('#copySummary').addEventListener('click', ()=>{ const {approved, total, pct} = progressInfo(); const lines = [`Brand: ${data.client.name}`, `Approved: ${approved}/${total} (${pct}%)`, '‚Äî']; Object.entries(reviewState.sections||{}).forEach(([id, v])=>{ if (!v.status) return; const title = sections.find(s=>s.id===id)?.title || id; lines.push(`${v.status==='approved'?'‚úÖ':'‚úçÔ∏è'} ${title}`); if (v.note) lines.push(`  Note: ${v.note}`); }); navigator.clipboard.writeText(lines.join('\n')).then(()=>{ alert('Summary copied to clipboard.'); }); });
  $('#printPdf').addEventListener('click', ()=> window.print());
  (function(){ const banner = $('#welcomeBanner'); const dismissBtn = $('#dismissBanner'); if (!banner || !dismissBtn) return; if (localStorage.getItem('p1_banner_dismissed_v4')) { banner.style.display = 'none'; } dismissBtn.addEventListener('click', () => { banner.style.display = 'none'; localStorage.setItem('p1_banner_dismissed_v4', 'true'); }); })();
  
  recalcProgress(); // Initial calc to set correct progress on load
  </script>
</body>
</html>